---
layout:     post
title:      "Unexpected Danger's of preg_replace"
subtitle:   "Code execution"
date:       2016-02-23 21:00:00
author:     "Heeraj"
header-img: "img/post-bg-02.png"
---
<script type='text/javascript' src='//eclkmpbn.com/adServe/banners?tid=98477_161886_3&type=footer&size=468x60'></script>
<p> If you like to read our old blogs you are welcome, <a href="http://heeraj123.wordpress.com">I4INFO</a> </p>

<p>There are high chance of the remote code execution in PHP web applications from  improper handling of PCRE(Perl compatible Regular Expression). PCRE is mainly used in preg functions in PHP such as in preg_match and preg_replace.Its safe most of the time, the only case its vulnerable is when you use /e modifier, which allow PHP code execution in preg_replace.</p>

<blockquote>
<?php<br>
$string = "You are in i4info";<br>
print preg_replace('/(.*)/e','strtoupper("\\1")','$string');<br>
?>
</blockquote>

<p>The output would be "YOU ARE IN I4INFO", the main thing is preg_replace can execute any php function.</p>

<blockquote>
<?php<br>
$string = "system('ls -lah')";<br>
print preg_replace('/(.*)/e','strtoupper("\\1")','$string');<br>
?>
</blockquote>

<p>Here the system('ls -lah') gets changed to system(\'ls -lah\'), So there would be some other way to bypass it. This can be changed
by using a backtick("`ls -lah`";")</p>

<p>This was one of the problems in web in Internetwache CTF.</p>

<p>Thank you for reading the blog! </p>
